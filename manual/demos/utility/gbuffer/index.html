<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="map[email:vanruesc@outlook.de name:Raoul van Rüschen]"><meta name=generator content="Hugo 0.152.2"><title>Geometry Buffer &#183; Post Processing Manual</title><base href=//pmndrs.github.io/postprocessing/manual/><script>"use strict";(()=>{localStorage.getItem("dark-mode")==="enabled"&&document.documentElement.classList.add("dark")})()</script><link rel=stylesheet href=/postprocessing/manual/css/dist/index.65f0f996d638e0fd51d31090c2312af5732104870a43ae77d7310801fea3c909.css integrity="sha256-ZfD5ltY44P1R0xCQwjEq9XMhBIcKQ6531zEIAf6jyQk=" crossorigin=anonymous><script defer src=/postprocessing/manual/js/dist/index.55b8038d8cb75af9e822adde2b9cac5e04837aee89fc579733b407008aa142f7.js integrity="sha256-VbgDjYy3WvnoIq3eK5ysXgSDeu6J/FeXM7QHAIqhQvc=" crossorigin=anonymous></script><script defer src=/postprocessing/manual/js/dist/libs/vendor.a0d935b8b50e2836f7a7e9c569f12a9a428e4e3b4fc4102ddef0103f0de58576.js integrity="sha256-oNk1uLUOKDb3p+nFafEqmkKOTjtPxBAt3vAQPw3lhXY=" crossorigin=anonymous></script><script defer src=/postprocessing/manual/js/dist/demos/gbuffer.db87421f7133829559a28c86e2b6f15c6d718145dbaba3c8f23ca3d1e66cd6de.js integrity="sha256-24dCH3EzgpVZooyG4rbxXG1xgUXbq6PI8jyj0eZs1t4=" crossorigin=anonymous></script></head><body class="preload demos single"><div class=frame-content><div><a class=skip-to-content href=/postprocessing/manual/demos/utility/gbuffer/#content>Skip to content</a><div class=sidebar-button-open aria-label="Open navigation menu"></div><div class=sidebar><header class=page-header><div class=page-title><a href=//pmndrs.github.io/postprocessing/manual/>Post Processing Manual</a></div><div class=sidebar-button-close aria-label="Close navigation menu"></div></header><nav class=navigation><div class=search><pagefind-config bundle-path=//pmndrs.github.io/postprocessing/manual/pagefind/ excerpt-length=10></pagefind-config><pagefind-searchbox></pagefind-searchbox></div><ul><li class="menu main expanded" data-id=main><h2>Start</h2><ul><li class=manual><a href=/postprocessing/manual/><span>Introduction</span></a></li><li class=getting-started><a href=/postprocessing/manual/getting-started/><span>Getting Started</span></a></li><li class=custom-passes><a href=/postprocessing/manual/custom-passes/><span>Custom Passes</span></a></li><li class=custom-effects><a href=/postprocessing/manual/custom-effects/><span>Custom Effects</span></a></li><li class=migration-guide><a href=/postprocessing/manual/migration-guide/><span>Migration Guide</span></a></li><li><a href=../docs/ target=_blank><span>API Reference</span></a></li></ul></li><li class="menu community expanded" data-id=community><h2>Community</h2><ul><li class=plugins-tools><a href=/postprocessing/manual/plugins-tools/><span>Plugins and Tools</span></a></li><li><a href=https://github.com/pmndrs/postprocessing/issues target=_blank><span>Issue Tracker</span></a></li><li><a href=https://discord.com/invite/poimandres target=_blank><span>Discord</span></a></li><li><a href=https://github.com/pmndrs/postprocessing/discussions target=_blank><span>Forum</span></a></li></ul></li><li class="menu demos active expanded" data-id=demos><h2>Demos</h2><ul><li class="menu anti-aliasing" data-id=anti-aliasing><h3>Anti-Aliasing</h3><div><ul><li class=fxaa><a href=/postprocessing/manual/demos/anti-aliasing/fxaa/><span>FXAA</span></a></li><li class=msaa><a href=/postprocessing/manual/demos/anti-aliasing/msaa/><span>MSAA</span></a></li><li class=smaa><a href=/postprocessing/manual/demos/anti-aliasing/smaa/><span>SMAA</span></a></li></ul></div></li><li class="menu color-grading" data-id=color-grading><h3>Color Grading</h3><div><ul><li class=lut><a href=/postprocessing/manual/demos/color-grading/lut/><span>LUT</span></a></li><li class=tone-mapping><a href=/postprocessing/manual/demos/color-grading/tone-mapping/><span>Tone Mapping</span></a></li></ul></div></li><li class="menu special-effects" data-id=special-effects><h3>Special Effects</h3><div><ul><li class=ascii><a href=/postprocessing/manual/demos/special-effects/ascii/><span>ASCII</span></a></li><li class=color-depth><a href=/postprocessing/manual/demos/special-effects/color-depth/><span>Color Depth</span></a></li><li class=halftone><a href=/postprocessing/manual/demos/special-effects/halftone/><span>Halftone</span></a></li><li class=noise><a href=/postprocessing/manual/demos/special-effects/noise/><span>Noise</span></a></li><li class=scanlines><a href=/postprocessing/manual/demos/special-effects/scanlines/><span>Scanlines</span></a></li><li class=vignette><a href=/postprocessing/manual/demos/special-effects/vignette/><span>Vignette</span></a></li></ul></div></li><li class="menu light-shadow" data-id=light-shadow><h3>Light & Shadow</h3><div><ul><li class=bloom><a href=/postprocessing/manual/demos/light-shadow/bloom/><span>Bloom</span></a></li></ul></div></li><li class="menu utility active expanded" data-id=utility><h3>Utility</h3><div><ul><li class=blur><a href=/postprocessing/manual/demos/utility/blur/><span>Blur</span></a></li><li class=depth-picking><a href=/postprocessing/manual/demos/utility/depth-picking/><span>Depth Picking</span></a></li><li class="gbuffer active"><a href=/postprocessing/manual/demos/utility/gbuffer/><span>Geometry Buffer</span></a></li><li class=lens-distortion><a href=/postprocessing/manual/demos/utility/lens-distortion/><span>Lens Distortion</span></a></li><li class=scissor-viewport><a href=/postprocessing/manual/demos/utility/scissor-viewport/><span>Scissor & Viewport</span></a></li><li class=texture><a href=/postprocessing/manual/demos/utility/texture/><span>Texture</span></a></li><li class=ui><a href=/postprocessing/manual/demos/utility/ui/><span>User Interface</span></a></li></ul></div></li></ul></li></ul></nav><footer class=page-footer><div class=contentinfo><ul><li class=legal><a href=/postprocessing/manual/legal/><span>Legal</span></a></li><li class=privacy><a href=/postprocessing/manual/privacy/><span>Privacy Policy</span></a></li></ul></div><div class=buttons><div class=dark-mode title="Dark mode"></div><a href=https://github.com/pmndrs/postprocessing target=_blank><div class=repository title=Repository></div></a><a href=https://github.com/sponsors/vanruesc target=_blank><div class=support title=Support></div></a></div></footer></div><main id=main class=gbuffer tabindex=-1><div id=viewport class=loading><div class=progress aria-label=loading><div class="spinner cubegrid"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div class=buttons><div class="icon fullscreen" title=Fullscreen></div><a href=https://github.com/pmndrs/postprocessing/tree/main/manual/assets/js/src/demos/gbuffer.js target=_blank title=Code><div class="icon code"></div></a><a href=/postprocessing/manual/attribution target=_blank title=Attribution><div class="icon info"></div></a></div><div class=tp></div><div class="warning hidden" aria-label=Warning><h4>Warning</h4><p>The following contains flashing imagery that may cause discomfort and/or seizures for those with photosensitive epilepsy.</p><a>Continue</a></div><div class="paused hidden" aria-label=Paused></div><div class="error hidden" aria-label=Error><h4>Error</h4><p></p></div></div><div id=content class=content><div data-pagefind-body><h1 id=geometry-buffer><span>Geometry Buffer</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#geometry-buffer data-pagefind-ignore>¶</a></h1><h2 id=geometrypass><span>GeometryPass</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#geometrypass data-pagefind-ignore>¶</a></h2><p>The <code>GeometryPass</code> is responsible for rendering a scene and its output serves as the starting point in a render pipeline. This output is generally referred to as a &ldquo;G-Buffer&rdquo; and in its simplest form, it only consists of a single color texture attachment. With <a href=https://registry.khronos.org/webgl/specs/latest/2.0/#3.7.11>MRT</a> it&rsquo;s possible to render to multiple buffers at once which enables more advanced effects. Without MRT, the entire scene would have to be rendered multiple times to obtain various types of geometry data.</p><p>Depending on the requirements of other passes in the pipeline, the <code>GeometryPass</code> will configure a G-Buffer that contains the needed texture attachments. The individual render textures will then be provided to the passes that requested them.</p><h3 id=alpha><span>Alpha</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#alpha data-pagefind-ignore>¶</a></h3><p>Postprocessing uses the compact <code>R11F_G11F_B10F</code> framebuffer format by default which requires alpha to be disabled. This reduces memory usage for most internal color buffers by 50% while still yielding sufficient precision to combat banding. However, if you need to use transparent framebuffers, you can enable alpha as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>geoPass</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>GeometryPass</span><span class=p>(</span><span class=nx>scene</span><span class=p>,</span> <span class=nx>camera</span><span class=p>,</span> <span class=p>{</span> <span class=nx>alpha</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span></code></pre></div><blockquote class="alert alert-note"><div class=alert-heading><div class=alert-icon></div><span>Note</span></div><p>Enabling alpha changes the internal framebuffer format to <code>RGBA16F</code>.</p></blockquote><h3 id=depth><span>Depth</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#depth data-pagefind-ignore>¶</a></h3><p>Scene depth is usually stored in a standard depth buffer for fixed-function depth testing only. However, if there is any pass that requires depth input, the depth data will be stored in a <code>DepthTexture</code> instead. The format of the depth texture will either be <code>UnsignedInt248Type</code> if the <code>stencilBuffer</code> setting is enabled, or <code>FloatType</code> if it&rsquo;s disabled.</p><h3 id=normals><span>Normals</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#normals data-pagefind-ignore>¶</a></h3><p>View space normals are encoded using Octahedron Normal Vector Encoding which converts the normal vectors into 2 uniformly packed floats. Not only does this save space in the G-Buffer but it also increases the effective precision of the normals because it uses the whole range of values that can be expressed with 16 bit floats.</p><h2 id=clearpass><span>ClearPass</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#clearpass data-pagefind-ignore>¶</a></h2><p>Postprocessing pipelines process image data in a step-by-step fashion and it&rsquo;s crucial to not clear intermediate results unintentionally. Therefore, clearing has to be performed explicitly by using instances of <code>ClearPass</code> where needed. This special pass operates on the default output buffer of the next pass. If that next pass is a <code>GeometryPass</code>, clearing will be performed on the G-Buffer.</p><blockquote class="alert alert-note"><div class=alert-heading><div class=alert-icon></div><span>Note</span></div><p>The <code>GeometryPass</code> does not clear its output buffer automatically. Instead, an explicit <code>ClearPass</code> must be used before it.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pipeline</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>RenderPipeline</span><span class=p>(</span><span class=nx>renderer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>pipeline</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>new</span> <span class=nx>ClearPass</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>  <span class=k>new</span> <span class=nx>GeometryPass</span><span class=p>(</span><span class=nx>scene</span><span class=p>,</span> <span class=nx>camera</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h2 id=external-resources><span>External Resources</span>&nbsp;<a href=/postprocessing/manual/demos/utility/gbuffer/#external-resources data-pagefind-ignore>¶</a></h2><ul><li><a href=https://www.khronos.org/opengl/wiki/Framebuffer#Buffer_clearing>Buffer Clearing</a></li><li><a href=https://knarkowicz.wordpress.com/2014/04/16/octahedron-normal-vector-encoding/>Octahedron Normal Vector Encoding</a></li><li><a href=https://jcgt.org/published/0003/02/01/>Survey of Efficient Representations for Independent Unit Vectors</a></li><li><a href=https://johnwhite3d.blogspot.com/2017/10/signed-octahedron-normal-encoding.html>Signed Octahedron Normal Encoding</a></li><li><a href=https://discuss.cocos2d-x.org/t/tutorial-a-comprehensive-explanation-of-deferred-rendering-guide-to-cocos-cyberpunk-source-code/58769>A Comprehensive Explanation of Deferred Rendering</a></li></ul></div></div></main></div></div><script>"use strict";(()=>{function e(){let t=document.querySelector(".navigation"),n=localStorage.getItem("expanded-menus"),e=n!==null?JSON.parse(n):null;if(!(t===null||e===null||!Array.isArray(e))){for(let e of t.querySelectorAll(".menu"))e.classList.remove("expanded");if(e.length!==0)try{for(let n of t.querySelectorAll(e.map(e=>`.menu.${e}`).join(",")))n.classList.add("expanded")}catch{localStorage.removeItem("expanded-menus"),window.location.reload()}}}function t(){let e=document.querySelector(".navigation"),t=document.querySelector("main");e!==null&&t!==null&&(e.scrollTop=Number(sessionStorage.getItem("nav-scroll")),t.scrollTop=Number(sessionStorage.getItem("main-scroll")))}e(),t()})()</script></body></html>