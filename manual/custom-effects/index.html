<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="map[email:vanruesc@outlook.de name:Raoul van Rüschen]"><meta name=generator content="Hugo 0.152.2"><title>Custom Effects &#183; Post Processing Manual</title><base href=//pmndrs.github.io/postprocessing/manual/><script>"use strict";(()=>{localStorage.getItem("dark-mode")==="enabled"&&document.documentElement.classList.add("dark")})()</script><link rel=stylesheet href=/postprocessing/manual/css/dist/index.65f0f996d638e0fd51d31090c2312af5732104870a43ae77d7310801fea3c909.css integrity="sha256-ZfD5ltY44P1R0xCQwjEq9XMhBIcKQ6531zEIAf6jyQk=" crossorigin=anonymous><script defer src=/postprocessing/manual/js/dist/index.55b8038d8cb75af9e822adde2b9cac5e04837aee89fc579733b407008aa142f7.js integrity="sha256-VbgDjYy3WvnoIq3eK5ysXgSDeu6J/FeXM7QHAIqhQvc=" crossorigin=anonymous></script><script defer src=/postprocessing/manual/js/dist/libs/vendor.837b5efd71f562a99a22748ff2b7532bf080625848b68abf75964c0b5e2156b0.js integrity="sha256-g3te/XH1YqmaInSP8rdTK/CAYlhItoq/dZZMC14hVrA=" crossorigin=anonymous></script></head><body class="preload page single"><div class=frame-content><div><a class=skip-to-content href=/postprocessing/manual/custom-effects/#content>Skip to content</a><div class=sidebar-button-open aria-label="Open navigation menu"></div><div class=sidebar><header class=page-header><div class=page-title><a href=//pmndrs.github.io/postprocessing/manual/>Post Processing Manual</a></div><div class=sidebar-button-close aria-label="Close navigation menu"></div></header><nav class=navigation><div class=search><pagefind-config bundle-path=//pmndrs.github.io/postprocessing/manual/pagefind/ excerpt-length=10></pagefind-config><pagefind-searchbox></pagefind-searchbox></div><ul><li class="menu main active expanded" data-id=main><h2>Start</h2><ul><li class=manual><a href=/postprocessing/manual/><span>Introduction</span></a></li><li class=getting-started><a href=/postprocessing/manual/getting-started/><span>Getting Started</span></a></li><li class=custom-passes><a href=/postprocessing/manual/custom-passes/><span>Custom Passes</span></a></li><li class="custom-effects active"><a href=/postprocessing/manual/custom-effects/><span>Custom Effects</span></a></li><li class=migration-guide><a href=/postprocessing/manual/migration-guide/><span>Migration Guide</span></a></li><li><a href=../docs/ target=_blank><span>API Reference</span></a></li></ul></li><li class="menu community expanded" data-id=community><h2>Community</h2><ul><li class=plugins-tools><a href=/postprocessing/manual/plugins-tools/><span>Plugins and Tools</span></a></li><li><a href=https://github.com/pmndrs/postprocessing/issues target=_blank><span>Issue Tracker</span></a></li><li><a href=https://discord.com/invite/poimandres target=_blank><span>Discord</span></a></li><li><a href=https://github.com/pmndrs/postprocessing/discussions target=_blank><span>Forum</span></a></li></ul></li><li class="menu demos" data-id=demos><h2>Demos</h2><ul><li class="menu anti-aliasing" data-id=anti-aliasing><h3>Anti-Aliasing</h3><div><ul><li class=fxaa><a href=/postprocessing/manual/demos/anti-aliasing/fxaa/><span>FXAA</span></a></li><li class=msaa><a href=/postprocessing/manual/demos/anti-aliasing/msaa/><span>MSAA</span></a></li><li class=smaa><a href=/postprocessing/manual/demos/anti-aliasing/smaa/><span>SMAA</span></a></li></ul></div></li><li class="menu color-grading" data-id=color-grading><h3>Color Grading</h3><div><ul><li class=lut><a href=/postprocessing/manual/demos/color-grading/lut/><span>LUT</span></a></li><li class=tone-mapping><a href=/postprocessing/manual/demos/color-grading/tone-mapping/><span>Tone Mapping</span></a></li></ul></div></li><li class="menu special-effects" data-id=special-effects><h3>Special Effects</h3><div><ul><li class=ascii><a href=/postprocessing/manual/demos/special-effects/ascii/><span>ASCII</span></a></li><li class=color-depth><a href=/postprocessing/manual/demos/special-effects/color-depth/><span>Color Depth</span></a></li><li class=halftone><a href=/postprocessing/manual/demos/special-effects/halftone/><span>Halftone</span></a></li><li class=noise><a href=/postprocessing/manual/demos/special-effects/noise/><span>Noise</span></a></li><li class=scanlines><a href=/postprocessing/manual/demos/special-effects/scanlines/><span>Scanlines</span></a></li><li class=vignette><a href=/postprocessing/manual/demos/special-effects/vignette/><span>Vignette</span></a></li></ul></div></li><li class="menu light-shadow" data-id=light-shadow><h3>Light & Shadow</h3><div><ul><li class=bloom><a href=/postprocessing/manual/demos/light-shadow/bloom/><span>Bloom</span></a></li></ul></div></li><li class="menu utility" data-id=utility><h3>Utility</h3><div><ul><li class=blur><a href=/postprocessing/manual/demos/utility/blur/><span>Blur</span></a></li><li class=depth-picking><a href=/postprocessing/manual/demos/utility/depth-picking/><span>Depth Picking</span></a></li><li class=gbuffer><a href=/postprocessing/manual/demos/utility/gbuffer/><span>Geometry Buffer</span></a></li><li class=lens-distortion><a href=/postprocessing/manual/demos/utility/lens-distortion/><span>Lens Distortion</span></a></li><li class=scissor-viewport><a href=/postprocessing/manual/demos/utility/scissor-viewport/><span>Scissor & Viewport</span></a></li><li class=texture><a href=/postprocessing/manual/demos/utility/texture/><span>Texture</span></a></li><li class=ui><a href=/postprocessing/manual/demos/utility/ui/><span>User Interface</span></a></li></ul></div></li></ul></li></ul></nav><footer class=page-footer><div class=contentinfo><ul><li class=legal><a href=/postprocessing/manual/legal/><span>Legal</span></a></li><li class=privacy><a href=/postprocessing/manual/privacy/><span>Privacy Policy</span></a></li></ul></div><div class=buttons><div class=dark-mode title="Dark mode"></div><a href=https://github.com/pmndrs/postprocessing target=_blank><div class=repository title=Repository></div></a><a href=https://github.com/sponsors/vanruesc target=_blank><div class=support title=Support></div></a></div></footer></div><main id=main class=custom-effects tabindex=-1><div id=content class=content><div data-pagefind-body><h1 id=custom-effects><span>Custom Effects</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#custom-effects data-pagefind-ignore>¶</a></h1><h2 id=introduction><span>Introduction</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#introduction data-pagefind-ignore>¶</a></h2><p><a href=../docs/classes/Effect.html>Effects</a> are headless fullscreen passes. They can be combined and rendered using the <a href=../docs/classes/EffectPass.html>EffectPass</a>. Just like passes, effects may perform initialization tasks, react to render size changes and execute supporting render operations if needed but they don&rsquo;t have access to a default output buffer and are not supposed to render to screen by themselves.</p><details><summary>TL;DR</summary><p><p><strong>shader.frag</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>weights</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>vec4</span> <span class=n>mainImage</span><span class=p>(</span><span class=k>const</span> <span class=k>in</span> <span class=k>vec4</span> <span class=n>inputColor</span><span class=p>,</span> <span class=k>const</span> <span class=k>in</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>,</span> <span class=k>const</span> <span class=k>in</span> <span class=n>GData</span> <span class=n>gData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=k>vec4</span><span class=p>(</span><span class=n>inputColor</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>weights</span><span class=p>,</span> <span class=n>inputColor</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>CustomEffect.js</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Uniform</span><span class=p>,</span> <span class=nx>Vector3</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;three&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Effect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;postprocessing&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Tip: Use a bundler plugin like esbuild-plugin-glsl to import shaders as text.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>fragmentShader</span> <span class=nx>from</span> <span class=s2>&#34;./shader.frag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>CustomEffect</span> <span class=kr>extends</span> <span class=nx>Effect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=kr>super</span><span class=p>(</span><span class=s2>&#34;CustomEffect&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=p>.</span><span class=nx>fragmentShader</span> <span class=o>=</span> <span class=nx>fragmentShader</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=kr>const</span> <span class=nx>uniforms</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>input</span><span class=p>.</span><span class=nx>uniforms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nx>uniforms</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;weights&#34;</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Uniform</span><span class=p>(</span><span class=k>new</span> <span class=nx>Vector3</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></p></details><h2 id=shader-function-signatures><span>Shader Function Signatures</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#shader-function-signatures data-pagefind-ignore>¶</a></h2><h3 id=fragment-shader><span>Fragment Shader</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#fragment-shader data-pagefind-ignore>¶</a></h3><p>Every effect must provide a fragment shader that implements at least one of these two functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>vec4</span> <span class=n>mainImage</span><span class=p>(</span><span class=k>in</span> <span class=k>vec4</span> <span class=n>inputColor</span><span class=p>,</span> <span class=k>in</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>,</span> <span class=k>in</span> <span class=n>GData</span> <span class=n>gData</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=n>mainUv</span><span class=p>(</span><span class=k>inout</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=vertex-shader><span>Vertex Shader</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#vertex-shader data-pagefind-ignore>¶</a></h3><p>Effects may also provide a vertex shader that implements the following function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>void</span> <span class=n>mainSupport</span><span class=p>(</span><span class=k>in</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=geometry-data><span>Geometry Data</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#geometry-data data-pagefind-ignore>¶</a></h3><p>Effects have access to the geometry data of the current fragment via the <code>GData</code> parameter of the <code>mainImage</code> function. The <code>EffectPass</code> detects whether an effect reads a value from this struct and only fetches the relevant data from the respective textures when it&rsquo;s actually needed. The <code>GData</code> struct is defined as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>struct</span> <span class=n>GData</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>vec4</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>float</span> <span class=n>depth</span>
</span></span><span class=line><span class=cl>	<span class=k>vec3</span> <span class=n>normal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>vec2</span> <span class=n>velocity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>vec3</span> <span class=n>position</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>vec3</span> <span class=n>orm</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>vec3</span> <span class=n>emission</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>float</span> <span class=n>luminance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=convolution><span>Convolution</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#convolution data-pagefind-ignore>¶</a></h3><p>Effects that fetch additional samples from the input buffer inside the fragment shader are considered convolution effects. To prevent bad results, it is not allowed to have more than one convolution effect per <code>EffectPass</code>. These effects are also incompatible with effects that implement the <code>mainUv</code> function. Creating an <code>EffectPass</code> with incompatible effects or assigning a new list of incompatible effects to an existing pass will throw an error.</p><h2 id=uniforms-macros-and-varyings><span>Uniforms, Macros and Varyings</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#uniforms-macros-and-varyings data-pagefind-ignore>¶</a></h2><p>All effect shaders have access to the following uniforms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>projectionMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>projectionMatrixInverse</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>viewMatrix</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=n>mat4</span> <span class=n>viewMatrixInverse</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>cameraParams</span><span class=p>;</span> <span class=c1>// near, far, aspect</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=k>vec4</span> <span class=n>resolution</span><span class=p>;</span> <span class=c1>// screen resolution (xy), texel size (zw)</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>inputBuffer</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=k>float</span> <span class=n>time</span><span class=p>;</span>
</span></span></code></pre></div><p>The fragment shader has access to the following G-Buffer uniform:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>struct</span> <span class=n>GBuffer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>depth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>normal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>orm</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>emission</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>velocity</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=n>GBuffer</span> <span class=n>gBuffer</span><span class=p>;</span>
</span></span></code></pre></div><p>The following varyings are reserved:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>inout</span> <span class=k>vec2</span> <span class=n>vUv</span><span class=p>;</span>
</span></span></code></pre></div><p>Available vertex attributes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>in</span> <span class=k>vec3</span> <span class=n>position</span><span class=p>;</span>
</span></span></code></pre></div><p>Available macros:</p><ul><li>If the main camera is a <code>PerspectiveCamera</code>, the macro <code>PERSPECTIVE_CAMERA</code> will be defined.</li><li>If the geometry pass uses a float type color buffer, the macro <code>FRAMEBUFFER_PRECISION_HIGH</code> will be defined.</li></ul><blockquote class="alert alert-warning"><div class=alert-heading><div class=alert-icon></div><span>Warning</span></div><p>Effects may define custom uniforms, varyings, functions and preprocessor macros as usual, but should not define global variables or constants.</p></blockquote><h2 id=functions><span>Functions</span>&nbsp;<a href=/postprocessing/manual/custom-effects/#functions data-pagefind-ignore>¶</a></h2><p>The shader chunks <a href=https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/common.glsl.js>common</a>
and <a href=https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/packing.glsl.js>packing</a> are included in the fragment shader by default. Additionally, the following utility functions are available:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>float</span> <span class=n>readDepth</span><span class=p>(</span><span class=k>sampler2D</span> <span class=n>depthBuffer</span><span class=p>,</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>vec3</span> <span class=n>readNormal</span><span class=p>(</span><span class=k>sampler2D</span> <span class=n>normalBuffer</span><span class=p>,</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>vec2</span> <span class=n>readVelocity</span><span class=p>(</span><span class=k>sampler2D</span> <span class=n>velocityBuffer</span><span class=p>,</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>float</span> <span class=n>getViewZ</span><span class=p>(</span><span class=k>float</span> <span class=n>depth</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>vec3</span> <span class=n>getViewPosition</span><span class=p>(</span><span class=k>vec2</span> <span class=n>uv</span><span class=p>,</span> <span class=k>float</span> <span class=n>depth</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>vec3</span> <span class=n>getViewPosition</span><span class=p>(</span><span class=k>vec2</span> <span class=n>uv</span><span class=p>,</span> <span class=k>float</span> <span class=n>depth</span><span class=p>,</span> <span class=k>float</span> <span class=n>viewZ</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>vec3</span> <span class=n>getWorldPosition</span><span class=p>(</span><span class=k>vec3</span> <span class=n>viewPosition</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>float</span> <span class=n>getDistance</span><span class=p>(</span><span class=k>vec3</span> <span class=n>viewPosition</span><span class=p>);</span>
</span></span></code></pre></div><blockquote class="alert alert-info"><div class=alert-heading><div class=alert-icon></div><span>Info</span></div><p>The required samplers for the read* functions above are available via the <code>gBuffer</code> uniform.</p></blockquote></div></div></main></div></div><script>"use strict";(()=>{function e(){let t=document.querySelector(".navigation"),n=localStorage.getItem("expanded-menus"),e=n!==null?JSON.parse(n):null;if(!(t===null||e===null||!Array.isArray(e))){for(let e of t.querySelectorAll(".menu"))e.classList.remove("expanded");if(e.length!==0)try{for(let n of t.querySelectorAll(e.map(e=>`.menu.${e}`).join(",")))n.classList.add("expanded")}catch{localStorage.removeItem("expanded-menus"),window.location.reload()}}}function t(){let e=document.querySelector(".navigation"),t=document.querySelector("main");e!==null&&t!==null&&(e.scrollTop=Number(sessionStorage.getItem("nav-scroll")),t.scrollTop=Number(sessionStorage.getItem("main-scroll")))}e(),t()})()</script></body></html>