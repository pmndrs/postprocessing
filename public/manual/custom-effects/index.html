<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Raoul van Rüschen"><meta name=generator content="Hugo 0.147.9"><title>Custom Effects &#183; Post Processing Manual</title><base href=//pp.pmnd.rs/><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script>document.documentElement.classList[localStorage.getItem("dark-mode")?"add":"remove"]("dark")</script><link rel=stylesheet href=/css/dist/index.60cbe46f8fbf5f9e36f08d6e6e18aa508134999cf1f99de608031ec3075c112d.css integrity="sha256-YMvkb4+/X5428I1ubhiqUIE0mZzx+Z3mCAMewwdcES0="><script defer src=/js/dist/index.acfa24b773fbd4b374e1e0207a9fba69df39c3a331e40b3d41961c309c92c30d.js integrity="sha256-rPokt3P71LN04eAgep+6ad85w6Mx5As9QZYcMJySww0="></script><script defer src=/js/dist/libs/vendor.98a876644db294c07ad9b3fe671b047d2700d727e285c1f6dc105574337ac839.js integrity="sha256-mKh2ZE2ylMB62bP+ZxsEfScA1yfihcH23BBVdDN6yDk="></script></head><body class="preload page single"><div class=frame-content><div><a class=skip-main href=#main>Skip to content</a><div class=sidebar-button-open aria-label="Open navigation menu"></div><div class=sidebar><header class=page-header><h1 class=page-title><a href=/>Post Processing Manual</a></h1><div class=sidebar-button-close aria-label="Close navigation menu"></div></header><nav class=navigation><h2 class=main>Start</h2><ul class=menu><li><a href=/><span>Introduction</span></a></li><li class=getting-started><a href=/getting-started/><span>Getting Started</span></a></li><li class="custom-effects active"><a href=/custom-effects/><span>Custom Effects</span></a></li><li class=migration-guide><a href=/migration-guide/><span>Migration Guide</span></a></li><li><a href=../docs/ target=_blank><span>API Reference</span></a></li></ul><h2 class=community>Community</h2><ul class=menu><li class=plugins-tools><a href=/plugins-tools/><span>Plugins and Tools</span></a></li><li><a href=https://github.com/pmndrs/postprocessing/issues target=_blank><span>Issue Tracker</span></a></li><li><a href=https://discord.com/invite/poimandres target=_blank><span>Discord</span></a></li><li><a href=https://github.com/pmndrs/postprocessing/discussions target=_blank><span>Forum</span></a></li></ul><h2 class=demos>Demos</h2><ul class=menu><li class=anti-aliasing><h3>Anti-Aliasing</h3><ul class=sub-menu><li class=msaa><a href=/demos/anti-aliasing/msaa/><span>MSAA</span></a></li><li class=smaa><a href=/demos/anti-aliasing/smaa/><span>SMAA</span></a></li><li class=fxaa><a href=/demos/anti-aliasing/fxaa/><span>FXAA</span></a></li></ul></li><li class=color-grading><h3>Color Grading</h3><ul class=sub-menu><li class=brightness-contrast><a href=/demos/color-grading/brightness-contrast/><span>Brightness and Contrast</span></a></li><li class=hue-saturation><a href=/demos/color-grading/hue-saturation/><span>Hue and Saturation</span></a></li><li class=lut><a href=/demos/color-grading/lut/><span>LUT</span></a></li><li class=sepia><a href=/demos/color-grading/sepia/><span>Sepia</span></a></li><li class=tone-mapping><a href=/demos/color-grading/tone-mapping/><span>Tone Mapping</span></a></li></ul></li><li class=special-effects><h3>Special Effects</h3><ul class=sub-menu><li class=ascii><a href=/demos/special-effects/ascii/><span>ASCII</span></a></li><li class=chromatic-aberration><a href=/demos/special-effects/chromatic-aberration/><span>Chromatic Aberration</span></a></li><li class=color-depth><a href=/demos/special-effects/color-depth/><span>Color Depth</span></a></li><li class=depth-of-field><a href=/demos/special-effects/depth-of-field/><span>Depth of Field</span></a></li><li class=dot-screen><a href=/demos/special-effects/dot-screen/><span>Dot Screen</span></a></li><li class=glitch><a href=/demos/special-effects/glitch/><span>Glitch</span></a></li><li class=grid><a href=/demos/special-effects/grid/><span>Grid</span></a></li><li class=pixelation><a href=/demos/special-effects/pixelation/><span>Pixelation</span></a></li><li class=tilt-shift><a href=/demos/special-effects/tilt-shift/><span>Tilt Shift</span></a></li><li class=scanlines><a href=/demos/special-effects/scanlines/><span>Scanlines</span></a></li><li class=vignette><a href=/demos/special-effects/vignette/><span>Vignette</span></a></li></ul></li><li class=light-shadow><h3>Light & Shadow</h3><ul class=sub-menu><li class=bloom><a href=/demos/light-shadow/bloom/><span>Bloom</span></a></li><li class=god-rays><a href=/demos/light-shadow/god-rays/><span>God Rays</span></a></li><li class=ssao><a href=/demos/light-shadow/ssao/><span>SSAO</span></a></li></ul></li><li class=utility><h3>Utility</h3><ul class=sub-menu><li class=blur><a href=/demos/utility/blur/><span>Blur</span></a></li><li class=depth-picking><a href=/demos/utility/depth-picking/><span>Depth Picking</span></a></li><li class=outline><a href=/demos/utility/outline/><span>Outline</span></a></li><li class=texture><a href=/demos/utility/texture/><span>Texture</span></a></li></ul></li></ul></nav><footer class=page-footer><div class=contentinfo><ul class=menu><li class=legal><a href=/legal/><span>Legal</span></a></li><li class=privacy><a href=/privacy/><span>Privacy Policy</span></a></li></ul></div><div class=icons><div class=dark-mode title="Dark mode"></div><a href=https://github.com/pmndrs/postprocessing target=_blank><div class=repository title=Repository></div></a><a href=https://www.patreon.com/vanruesc target=_blank><div class=support title=Support></div></a></div></footer></div><main id=main class=custom-effects tabindex=-1><div class=content><div><h1 id=custom-effects>Custom Effects <a href=/custom-effects/#custom-effects>¶</a></h1><h2 id=introduction>Introduction <a href=/custom-effects/#introduction>¶</a></h2><p><a href>Effects</a> are headless fullscreen passes. They can be combined and rendered using the <a href>EffectPass</a>. Just like passes, effects may perform initialization tasks, react to render size changes and execute supporting render operations if needed but they don&rsquo;t have access to an output buffer and are not supposed to render to screen by themselves.</p><details><summary>TL;DR</summary><p><p><strong>shader.frag</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>weights</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>vec4</span> <span class=n>mainImage</span><span class=p>(</span><span class=k>in</span> <span class=k>vec4</span> <span class=n>inputColor</span><span class=p>,</span> <span class=k>in</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>,</span> <span class=k>in</span> <span class=n>GData</span> <span class=n>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=k>vec4</span><span class=p>(</span><span class=n>inputColor</span><span class=p>.</span><span class=n>rgb</span> <span class=o>*</span> <span class=n>weights</span><span class=p>,</span> <span class=n>inputColor</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>CustomEffect.js</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Uniform</span><span class=p>,</span> <span class=nx>Vector3</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;three&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Effect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;postprocessing&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Use a bundler plugin like esbuild-plugin-glsl to import shaders as text.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>fragmentShader</span> <span class=nx>from</span> <span class=s2>&#34;./shader.frag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>class</span> <span class=nx>CustomEffect</span> <span class=kr>extends</span> <span class=nx>Effect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=kr>super</span><span class=p>(</span><span class=s2>&#34;CustomEffect&#34;</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>uniforms</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>([</span>
</span></span><span class=line><span class=cl>				<span class=p>[</span><span class=s2>&#34;weights&#34;</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Uniform</span><span class=p>(</span><span class=k>new</span> <span class=nx>Vector3</span><span class=p>())]</span>
</span></span><span class=line><span class=cl>			<span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></p></details><h2 id=shader-function-signatures>Shader Function Signatures <a href=/custom-effects/#shader-function-signatures>¶</a></h2><h3 id=fragment-shader>Fragment Shader <a href=/custom-effects/#fragment-shader>¶</a></h3><p>Every effect must provide a fragment shader that implements at least one of these two functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>vec4</span> <span class=n>mainImage</span><span class=p>(</span><span class=k>in</span> <span class=k>vec4</span> <span class=n>inputColor</span><span class=p>,</span> <span class=k>in</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>,</span> <span class=k>in</span> <span class=n>GData</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=n>mainUv</span><span class=p>(</span><span class=k>inout</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=vertex-shader>Vertex Shader <a href=/custom-effects/#vertex-shader>¶</a></h3><p>Effects may also provide a vertex shader that implements the following function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>void</span> <span class=n>mainSupport</span><span class=p>(</span><span class=k>in</span> <span class=k>vec2</span> <span class=n>uv</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=geometry-data>Geometry Data <a href=/custom-effects/#geometry-data>¶</a></h3><p>Effects have access to the geometry data of the current fragment via the <code>data</code> parameter of the <code>mainImage</code> function. The <code>EffectPass</code> detects whether an effect reads a value from this struct and only fetches the relevant data from the respective textures when it&rsquo;s actually needed. If you wish to sample depth at another coordinate, use the predefined function <code>float readDepth(in vec2 uv)</code>. To calculate the view Z based on depth, you can use the predefined function <code>float getViewZ(in float depth)</code>. The <code>GData</code> is defined as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>struct</span> <span class=n>GData</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>vec3</span> <span class=n>position</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>vec3</span> <span class=n>normal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>float</span> <span class=n>depth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>float</span> <span class=n>luminance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>float</span> <span class=n>roughness</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=convolution>Convolution <a href=/custom-effects/#convolution>¶</a></h3><p>Effects that fetch additional samples from the input buffer inside the fragment shader are considered convolution effects. To prevent bad results, it is not allowed to have more than one convolution effect per <code>EffectPass</code>. These effects are also incompatible with effects that implement the <code>mainUv</code> function. The <code>EffectPass</code> will warn you when it encounters incompatible effects.</p><h2 id=uniforms-macros-and-varyings>Uniforms, Macros and Varyings <a href=/custom-effects/#uniforms-macros-and-varyings>¶</a></h2><p>All shaders have access to the following uniforms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>uniform</span> <span class=k>vec4</span> <span class=n>resolution</span><span class=p>;</span> <span class=c1>// screen resolution (xy), texel size (zw)</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=k>vec3</span> <span class=n>cameraParams</span><span class=p>;</span> <span class=c1>// near, far, aspect</span>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=k>float</span> <span class=n>time</span><span class=p>;</span>
</span></span></code></pre></div><p>The fragment shader has access to the following additional uniforms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>struct</span> <span class=n>GBuffer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>depth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>position</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>sampler2D</span> <span class=n>normal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>uniform</span> <span class=n>GBuffer</span> <span class=n>gBuffer</span><span class=p>;</span>
</span></span></code></pre></div><p>The following varyings are reserved:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>varying</span> <span class=k>vec2</span> <span class=n>vUv</span><span class=p>;</span>
</span></span></code></pre></div><p>Available vertex attributes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-glsl data-lang=glsl><span class=line><span class=cl><span class=k>attribute</span> <span class=k>vec3</span> <span class=n>position</span><span class=p>;</span>
</span></span></code></pre></div><p>Available macros:</p><ul><li>If the main camera is a <code>PerspectiveCamera</code>, the macro <code>PERSPECTIVE_CAMERA</code> will be defined.</li><li>If the geometry pass uses a float type color buffer, the macro <code>FRAMEBUFFER_PRECISION_HIGH</code> will be defined.</li></ul><p><em>Effects may define custom uniforms, varyings, functions and preprocessor macros as usual, but should not define global variables or constants.</em></p><p>Furthermore, the shader chunks <a href=https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/common.glsl.js>common</a>
and <a href=https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/packing.glsl.js>packing</a> are included in the fragment shader by default. The functions <code>packDepthToRGBA(v)</code> and <code>unpackRGBAToDepth(v)</code> are also available under the aliases <code>packFloatToRGBA(v)</code> and <code>unpackRGBAToFloat(v)</code>.</p><h2 id=webgl-extensions>WebGL Extensions <a href=/custom-effects/#webgl-extensions>¶</a></h2><p>Effects can enable WebGL 1 shader extensions via the <code>extensions</code> constructor option. The available <a href>WebGLExtensions</a> are <code>DERIVATIVES</code>, <code>FRAG_DEPTH</code>, <code>DRAW_BUFFERS</code> and <code>SHADER_TEXTURE_LOD</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MyEffect</span> <span class=kr>extends</span> <span class=nx>Effect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=kr>super</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>fragmentShader</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>extensions</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Set</span><span class=p>([</span><span class=nx>WebGLExtension</span><span class=p>.</span><span class=nx>DERIVATIVES</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div></div></main></div></div><script>document.querySelector(".navigation").scrollTop=Number(sessionStorage.getItem("nav-scroll")),document.querySelector("main").scrollTop=Number(sessionStorage.getItem("main-scroll"))</script></body></html>